@using InCaseIForgetMyCrochet.Models;


@if (Pattern is not null)
{
    <table class=" gap-3 my-3 w-100">
        @foreach (var stitch in Pattern.Rows)
        {
            <tr class="d-flex w-100">
                <ul>
                    <td class="col-1">
                        <button class="btn btn-danger" type="button" style="padding:.5rem 1rem;"
                            @onclick="@(async () => {Pattern.Rows.Remove(stitch); await Pattern.SaveChangesAsync(Context);})">X</button>
                    </td>
                    <div id="@(stitch.Id)" class="d-flex w-100" style="position:relative;">
                        @foreach (var instruction in stitch.Instructions)
                        {
                            <td style="position:relative;">
                                <button class="btn-danger" style="
                                height:2rem;
                                width:2rem;
                                position:absolute;
                                bottom:50%;
                                left:50%;"
                                    @onclick="@(async() => {stitch.Instructions.Remove(instruction); await Pattern.SaveChangesAsync(Context);})">
                                    <i class="bi bi-trash" />
                                </button>
                                <span class="d-flex rounded-pill" style="
                                background:@(instruction.StitchType.ToPastelColor());
                                cursor:default;
                                height:2.5rem;
                                place-content:center;
                                place-items:center;
                                place-self:center;
                                width:2.5rem;
                                z-index:0;">
                                    @instruction.StitchType
                                </span>
                            </td>
                        }
                        <label for="@(stitch.Id)" class="btn-outline-light p-2 text-center text-dark" style="
                        background: #0001;
                        border-radius:10rem;
                        font-size:.8rem;
                        position:absolute;
                        left:0%;
                        top:10%;
                        transform: translate(-50%, -50%);">
                            n:@stitch.Instructions.Count
                        </label>
                    </div>
                    <td class="col-1">
                        <button class="btn btn-info text-nowrap"
                            @onclick="@(async() => {stitch.Instructions.AddRange(Enumerable.Range(0, StitchAmount).Select(_ => new Instruction { StitchType = StitchType })); await Pattern.SaveChangesAsync(Context);})">
                            @StitchAmount @StitchType
                        </button>
                    </td>
                </ul>
            </tr>
        }
    </table>
}